<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Audit & Simulation IA — Numérion Éducation™</title>
<meta name="description" content="Audit de trésorerie numérique conforme MiCA/IFRS. Scénarios 1–3–5 %, liquidité, risques, opposabilité audit, plan 90 jours et recommandations exécutives." />
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%230a0a0a'/%3E%3Cpath d='M18 40 L32 16 L46 40' stroke='%23c9f31d' stroke-width='4' fill='none'/%3E%3C/svg%3E">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<meta property="og:title" content="Audit & Simulation IA — Numérion Éducation™">
<meta property="og:description" content="Rapport exécutif, scénarios 1–3–5 %, risques, liquidité, conformité MiCA/IFRS.">
<meta property="og:type" content="website">
<meta name="theme-color" content="#0a0a0a">

<style>
:root{
  --bg:#0a0a0a;--panel:#111;--soft:#171717;--line:#222;
  --text:#e6e6e6;--muted:#9ca3af;--accent:#c9f31d;
  --ok:#0ea5e9;--warn:#f59e0b;--good:#10b981;--bad:#ef4444;
  --radius:14px;--w:1140px
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
.wrap{max-width:var(--w);margin:0 auto;padding:0 20px}
a{color:var(--text);text-decoration:none}
.small{font-size:.9rem}.muted{color:var(--muted)}
.no-print{display:block}
.site-header{position:sticky;top:0;z-index:20;background:rgba(10,10,10,.9);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--line)}
.site-header .wrap{display:flex;align-items:center;gap:18px;padding:10px 20px}
.logo{height:28px}
nav{display:flex;gap:8px;flex:1;flex-wrap:wrap}
nav a{padding:6px 10px;border-radius:8px}
nav a:hover{background:var(--soft)}
.actions{display:flex;gap:10px}
.btn{background:var(--accent);color:#0a0a0a;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
.btn.secondary{background:#2a2a2a;color:#fff;border:1px solid #3a3a3a}
.btn.ghost{background:transparent;border:1px solid var(--line);color:var(--text)}
.btn:active{transform:translateY(1px)}
.hero{padding:48px 0;border-bottom:1px solid var(--line);background:
  linear-gradient(180deg,#0a0a0a 0%, #0c0c0c 100%)}
.hero h1{font-size:2rem;margin:0 0 8px}.subtitle{color:var(--muted)}
.hero-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-top:20px}
.badge,.qr{background:var(--soft);padding:14px;border-radius:var(--radius);border:1px solid var(--line)}
.badge strong{font-size:1.1rem}
.card{padding:32px 0;border-bottom:1px solid var(--line);position:relative}
.card h2{margin:0 0 16px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:22px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:22px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.bullets{line-height:1.5;margin:0;padding-left:16px}
.kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:14px}
.kpi{background:var(--soft);border:1px solid var(--line);padding:12px;border-radius:12px}
.kpi strong{display:block;font-size:1.2rem;margin-top:4px}
.table-wrap{margin-top:10px;overflow:auto;border:1px solid var(--line);border-radius:10px}
table{width:100%;border-collapse:collapse}
th,td{padding:8px 10px;border-bottom:1px solid var(--line);text-align:left;white-space:nowrap}
.scenario h3{margin:0 0 10px}
.note,.callout{margin-top:12px;padding:12px;border-radius:10px;border:1px solid var(--line);background:var(--soft)}
.callout.ok{border-left:6px solid var(--ok)}.callout.warn{border-left:6px solid var(--warn)}.callout.good{border-left:6px solid var(--good)}
.ticks{line-height:1.6;margin:0;padding-left:16px}
.doc-box{background:var(--soft);border:1px solid var(--line);padding:14px;border-radius:12px}
.risk-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.risk{background:var(--soft);border:1px solid var(--line);padding:14px;border-radius:12px;min-height:120px}
.plan90{background:var(--soft);border:1px solid var(--line);padding:14px;border-radius:12px}
.hashbox{background:var(--soft);border:1px solid var(--line);padding:12px;border-radius:12px;word-break:break-all}
.cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
.toc{position:sticky;top:64px;align-self:start}
.toc ul{list-style:none;padding:0;margin:0;display:flex;gap:8px;flex-wrap:wrap}
.toc a{border:1px solid var(--line);padding:6px 10px;border-radius:8px}
.watermark{position:fixed;inset:0;pointer-events:none;opacity:.035;background:
  repeating-linear-gradient(45deg,transparent 0 24px,#fff 24px 25px),
  repeating-linear-gradient(-45deg,transparent 0 24px,#fff 24px 25px)}
footer{padding:32px 0}
.footer-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.footer-card{background:var(--soft);border:1px solid var(--line);padding:14px;border-radius:12px}

@media (max-width:980px){
  .grid-2,.grid-3,.grid-4,.hero-grid{grid-template-columns:1fr}
  nav{display:none}
}

@media print{
  .no-print{display:none !important}
  body{print-color-adjust:exact;-webkit-print-color-adjust:exact}
  .card{page-break-inside:avoid}
  .hero{padding:20px 0}
  .table-wrap{overflow:visible}
  @page{size:A4;margin:14mm}
  body{counter-reset:page}
  footer::after{content:"Page " counter(page); position:fixed; bottom:8mm; right:14mm; color:#555}
}
</style>

<script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<!-- JSON-LD pour “Report” -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"Report",
  "name":"Audit & Simulation IA — Numérion Éducation",
  "datePublished":"2025-11-12",
  "inLanguage":"fr-FR",
  "about":["Trésorerie d'entreprise","MiCA","IFRS","Crypto-actifs"],
  "publisher":{"@type":"Organization","name":"Numérion Éducation"},
  "isAccessibleForFree":false
}
</script>
</head>

<body>
<div class="watermark" aria-hidden="true"></div>

<header class="site-header no-print" role="banner" aria-label="En-tête">
  <div class="wrap">
    <img class="logo" alt="Numérion Éducation" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='28'%3E%3Ctext x='0' y='20' fill='%23c9f31d' font-size='20' font-family='Arial'%3ENumérion%3C/text%3E%3C/svg%3E">
    <nav aria-label="Navigation principale">
      <a href="#executive">Synthèse</a><a href="#scenarios">Scénarios</a><a href="#sensitivity">Sensibilités</a><a href="#liquidity">Liquidité</a><a href="#risks">Risques</a><a href="#compliance">Conformité</a><a href="#recommendations">Reco</a><a href="#annexes">Annexes</a>
    </nav>
    <div class="actions">
      <button id="btnDownload" class="btn" aria-label="Imprimer en PDF">Télécharger le PDF</button>
      <button id="btnHash" class="btn secondary" aria-label="Générer l’empreinte">Générer l’empreinte</button>
      <button id="btnCSV" class="btn ghost" aria-label="Exporter CSV">Exporter CSV</button>
    </div>
  </div>
</header>

<section class="hero" role="region" aria-labelledby="title">
  <div class="wrap">
    <div class="toc no-print">
      <ul>
        <li><a href="#executive">Exécutif</a></li>
        <li><a href="#scenarios">Scénarios</a></li>
        <li><a href="#sensitivity">Sensibilités</a></li>
        <li><a href="#liquidity">Liquidité</a></li>
        <li><a href="#risks">Risques</a></li>
        <li><a href="#compliance">Conformité</a></li>
        <li><a href="#recommendations">Plan</a></li>
        <li><a href="#annexes">Annexes</a></li>
      </ul>
    </div>
    <h1 id="title">Audit & Simulation IA — <span id="companyName">Entreprise</span></h1>
    <p class="subtitle">Période auditée : <span id="period">12–24 mois</span> • Numéro d’audit : <span id="auditId">AUD-XXXX</span> • Date : <span id="auditDate">JJ/MM/AAAA</span></p>
    <div class="hero-grid" role="group" aria-label="Badges">
      <div class="badge"><div>Conformité</div><strong>MiCA • IFRS</strong></div>
      <div class="badge"><div>Allocation testée</div><strong>1% • 3% • 5%</strong></div>
      <div class="badge"><div>Livrable</div><strong>Rapport PDF signé</strong></div>
      <div class="qr"><div id="qrcode"></div><small>Lien sécurisé du rapport</small></div>
    </div>
  </div>
</section>

<section id="executive" class="card" aria-labelledby="execTitle">
  <div class="wrap">
    <h2 id="execTitle">Synthèse exécutive</h2>
    <div class="grid-2">
      <div>
        <ul id="executiveBullets" class="bullets"></ul>
        <div class="kpis" role="group" aria-label="Principaux indicateurs">
          <div class="kpi"><span>Trésorerie actuelle</span><strong id="kpiCash">—</strong></div>
          <div class="kpi"><span>Impact Score Numérion™</span><strong id="kpiImpact">—</strong></div>
          <div class="kpi"><span>Drawdown max simulé</span><strong id="kpiDD">—</strong></div>
          <div class="kpi"><span>Fenêtre de sortie</span><strong id="kpiExit">—</strong></div>
        </div>
        <div class="callout good" id="roiNote">ROI net vs baseline communiqué en annexe.</div>
      </div>
      <div><canvas id="chartOverview" height="200" aria-label="Courbe trésorerie baseline vs scénarios" role="img"></canvas></div>
    </div>
  </div>
</section>

<section id="scenarios" class="card" aria-labelledby="scTitle">
  <div class="wrap">
    <h2 id="scTitle">Simulation IA — Scénarios d’allocation</h2>
    <p class="muted">Comparaison “Trésorerie dormante vs optimisée” sur 12–24 mois. Hypothèses et méthodologie en annexe.</p>
    <div class="grid-3">
      <div class="scenario">
        <h3>Scénario 1%</h3>
        <canvas id="chartS1" height="160"></canvas>
        <div class="table-wrap"><table id="tableS1" aria-label="Tableau scénario 1%"></table></div>
      </div>
      <div class="scenario">
        <h3>Scénario 3%</h3>
        <canvas id="chartS3" height="160"></canvas>
        <div class="table-wrap"><table id="tableS3" aria-label="Tableau scénario 3%"></table></div>
      </div>
      <div class="scenario">
        <h3>Scénario 5%</h3>
        <canvas id="chartS5" height="160"></canvas>
        <div class="table-wrap"><table id="tableS5" aria-label="Tableau scénario 5%"></table></div>
      </div>
    </div>
    <div class="note"><strong>Note :</strong> simulations incluant inflation, taux sans risque, volatilité crypto lissée, frais de garde PSAN.</div>
  </div>
</section>

<section id="sensitivity" class="card" aria-labelledby="sensTitle">
  <div class="wrap">
    <h2 id="sensTitle">Analyse de sensibilité</h2>
    <div class="grid-2">
      <div>
        <canvas id="chartSensitivity" height="200" aria-label="Barres de sensibilité ROI" role="img"></canvas>
        <div class="callout ok">Variables testées : Inflation ±1 pt, Taux sans risque ±1 pt, Prime crypto ±20 %.</div>
      </div>
      <div class="doc-box">
        <h4>Hypothèses clés</h4>
        <ul class="bullets" id="assumptionsList"></ul>
        <div class="callout warn">Alerte : si la liquidité < seuil, suspension des allocations et revue comité.</div>
      </div>
    </div>
  </div>
</section>

<section id="liquidity" class="card" aria-labelledby="liqTitle">
  <div class="wrap">
    <h2 id="liqTitle">Analyse de liquidité</h2>
    <div class="grid-2">
      <div><canvas id="chartLiquidity" height="180" aria-label="Barres de liquidité par bucket" role="img"></canvas></div>
      <div>
        <ul id="liquidityBullets" class="bullets"></ul>
        <div class="callout ok">Fenêtres de cession prévues. Zéro pénalité de sortie sur la part trésorerie hors PSAN.</div>
      </div>
    </div>
  </div>
</section>

<section id="risks" class="card" aria-labelledby="riskTitle">
  <div class="wrap">
    <h2 id="riskTitle">Gestion des risques</h2>
    <div class="risk-grid">
      <div class="risk"><h4>Volatilité & Drawdown</h4><p id="riskVol">—</p></div>
      <div class="risk"><h4>Contrepartie & Garde</h4><p id="riskCustody">—</p></div>
      <div class="risk"><h4>Réglementaire</h4><p id="riskReg">—</p></div>
      <div class="risk"><h4>Opérationnel</h4><p id="riskOps">—</p></div>
    </div>
    <div class="callout warn">Rappel : allocation testée limitée à 1–5 % de la trésorerie. Gouvernance et signatures multiples recommandées.</div>
  </div>
</section>

<section id="compliance" class="card" aria-labelledby="compTitle">
  <div class="wrap">
    <h2 id="compTitle">Conformité MiCA / IFRS</h2>
    <div class="grid-2">
      <div><ul class="ticks" id="complianceList"></ul></div>
      <div class="doc-box">
        <h4>Dossier opposable audit</h4>
        <ul class="bullets">
          <li>Traçabilité des hypothèses et versions</li>
          <li>Procédures de garde PSAN</li>
          <li>Notes comptables IFRS</li>
          <li>Registre des accès et signatures</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<section id="recommendations" class="card" aria-labelledby="recoTitle">
  <div class="wrap">
    <h2 id="recoTitle">Recommandations</h2>
    <div class="grid-2">
      <div>
        <ol id="recoList"></ol>
        <div class="cta no-print">
          <a class="btn" href="#contact">Parler au comité</a>
          <a class="btn secondary" href="#annexes">Voir annexes</a>
        </div>
      </div>
      <div class="plan90">
        <h4>Plan 90 jours</h4>
        <ul id="plan90"></ul>
      </div>
    </div>
  </div>
</section>

<section id="annexes" class="card" aria-labelledby="annTitle">
  <div class="wrap">
    <h2 id="annTitle">Annexes & Opposabilité</h2>
    <div class="grid-2">
      <div>
        <h4>Méthodologie de simulation</h4>
        <ul class="bullets" id="methodo"></ul>
        <h4>Disclaimer</h4>
        <p class="muted small">Ce rapport est fourni à titre professionnel. Les performances passées ne préjugent pas des performances futures. L’entreprise demeure responsable de ses décisions.</p>
      </div>
      <div class="hashbox">
        <h4>Empreinte et version</h4>
        <p>Empreinte SHA-256 du document : <code id="pdfHash">—</code></p>
        <p>Commit : <code id="commitHash">—</code></p>
        <p>Lien audit : <span id="reportUrl">—</span></p>
        <p>ROI net estimé (S3 vs baseline) : <code id="roiNet">—</code></p>
      </div>
    </div>
    <div class="muted small">Numérion Éducation™ — Rapport confidentiel. © <span id="year"></span>. Tous droits réservés.</div>
  </div>
</section>

<section id="contact" class="card no-print" aria-labelledby="contactTitle">
  <div class="wrap">
    <h2 id="contactTitle">Contacter Numérion Éducation</h2>
    <div class="grid-2">
      <div class="footer-card">
        <p>Besoin d’une présentation au comité d’audit ou d’un dossier opposable complet ?</p>
        <div class="cta">
          <a class="btn" href="mailto:contact@numerion.education?subject=Audit%20tr%C3%A9sorerie%20%E2%80%94%20Demande%20comit%C3%A9">Envoyer un e-mail</a>
          <a class="btn secondary" target="_blank" rel="noopener" href="https://cal.com">Réserver un créneau</a>
        </div>
      </div>
      <form class="footer-card" name="contact-audit" method="POST" data-netlify="true">
        <input type="hidden" name="form-name" value="contact-audit">
        <label>Nom<br><input name="name" required style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f0f0f;color:var(--text)"></label><br><br>
        <label>Email pro<br><input name="email" type="email" required style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f0f0f;color:var(--text)"></label><br><br>
        <label>Message<br><textarea name="message" rows="4" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f0f0f;color:var(--text)"></textarea></label><br><br>
        <button class="btn" type="submit">Envoyer</button>
      </form>
    </div>
  </div>
</section>

<footer class="no-print">
  <div class="wrap">
    <div class="small muted">Préparé par Numérion Éducation™ — MiCA • IFRS • PSAN. Rapport confidentiel.</div>
  </div>
</footer>

<!-- ======= DATA JSON inline ======= -->
<script id="AUDIT_DATA" type="application/json">
{
  "reportUrl": "https://audit.client.numerion.education/ACME",
  "company": { "name": "ACME Industries", "period": "Jan 2025 – Déc 2026", "auditId": "AUD-2025-001", "date": "12/11/2025", "cash": 1250000 },
  "executive": {
    "bullets": [
      "Allocation progressive 1–5 % sous gouvernance duale.",
      "Exposition prioritaire BTC/ETH via PSAN régulé.",
      "Fenêtres de sortie trimestrielles alignées besoins CAPEX.",
      "Drawdown max simulé ≤ 8,7 % sur trésorerie totale.",
      "Gain net inflation sur 24 mois : +2,3 à +6,8 pts.",
      "Process IFRS documenté et opposable audit."
    ],
    "impactScore": 82, "drawdownMaxPct": 8.7, "exitWindow": "T+30 jours en cas de stress"
  },
  "scenarios": {
    "horizonMonths": 24, "baselineInflationPct": 2.5, "riskFreeYieldPct": 3.0,
    "series": [
      {"name":"1%","allocPct":1,"monthly":[1250000,1253200,1256400,1259100,1262400,1265600,1267800,1270200,1272400,1275600,1278300,1281500,1283600,1286500,1289300,1292400,1295600,1298400,1301500,1304300,1307200,1310200,1313100,1316000]},
      {"name":"3%","allocPct":3,"monthly":[1250000,1254800,1259800,1265200,1270400,1276000,1281400,1287200,1292600,1298600,1304200,1310400,1316200,1322600,1328600,1335200,1341400,1348200,1354600,1361600,1368200,1375400,1382200,1389600]},
      {"name":"5%","allocPct":5,"monthly":[1250000,1256500,1263600,1270600,1278200,1285600,1293600,1301400,1309800,1318000,1326800,1335400,1344600,1353600,1363200,1372600,1382600,1392400,1402800,1413000,1423800,1434400,1445600,1456600]}
    ],
    "baseline":[1250000,1252600,1255200,1257400,1260000,1262600,1265200,1267400,1270000,1272600,1275200,1277400,1280000,1282600,1285200,1287400,1290000,1292600,1295200,1297400,1300000,1302600,1305200,1307400]
  },
  "liquidity": {
    "buckets":[{"label":"J+0","amount":950000},{"label":"J+1 à J+7","amount":250000},{"label":"J+8 à J+30","amount":50000}],
    "bullets":["95 % mobilisable J+0 via comptes courants.","PSAN avec fenêtres T+1 pour l’allocation crypto.","Seuil d’alerte de liquidité à 200 k€."]
  },
  "risks": {
    "volatility":"Poche crypto bornée à 1–5 % pour caper la variance. Backtest 24 mois incluant stress 2024.",
    "custody":"Conservation via PSAN régulé. Comptes ségrégués. Multi-signature et registre d’accès.",
    "regulatory":"Conformité MiCA et documentation IFRS pour la comptabilisation des actifs numériques.",
    "operational":"Double validation DAF/CEO. Procédures écrites. RACI et plan de continuité."
  },
  "compliance": { "items": ["Mandat et NDA signés","Traçabilité des hypothèses","Procédures de garde PSAN","Notes IFRS à jour","Journal des accès"] },
  "recommendations": {
    "steps":["Démarrer à 1 % pendant 90 jours avec reporting mensuel.","Étendre à 3 % après revue de comité et résultats.","Limiter 5 % si conditions de marché validées."],
    "plan90":["S1–S2 : ouverture PSAN + registre gouvernance","S3 : première allocation 1 %","S4–S8 : reporting, revue risques, fenêtres de sortie","S9–S12 : comité, montée à 3 % conditionnelle"]
  },
  "methodology":["Baseline = cash + taux sans risque + inflation.","Scénarios = baseline + prime crypto lissée + frais PSAN.","Drawdown mesuré sur trésorerie totale.","Ajustements prudents sur volatilité et corrélation."],
  "assumptions":["Inflation 2,5 %","Taux sans risque 3 %","Prime crypto lissée 6–12 % annualisée","Frais PSAN 0,8–1,2 %","Volatilité annualisée capée sur poche 1–5 %"],
  "security":{"commitHash":"abcdef1","year":2025}
}
</script>

<script>
(function(){
  // ===== Helpers
  const $ = s => document.querySelector(s);
  const id = s => document.getElementById(s);
  const setText = (sel,v)=>{ const el=$(sel); if(el) el.textContent=v; };
  const listTo = (sel,items=[])=>{ const el=$(sel); if(!el) return; el.innerHTML=''; items.forEach(t=>{const li=document.createElement('li'); li.textContent=t; el.appendChild(li);});};
  const orderedListTo=(sel,items=[])=>{ const el=$(sel); if(!el) return; el.innerHTML=''; items.forEach(t=>{const li=document.createElement('li'); li.textContent=t; el.appendChild(li);});};
  const eur = v => Number(v||0).toLocaleString('fr-FR',{style:'currency',currency:'EUR'});
  const labelsMonths = n => Array.from({length:n},(_,i)=>`M${i+1}`);
  const ds = (label,data)=>({label,data:(data||[]),tension:.25,pointRadius:0});
  const line = (sel,cfg)=>{ const el=$(sel); if(!el) return;
    new Chart(el,{type:'line',data:{labels:cfg.labels,datasets:cfg.datasets},
      options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#e6e6e6'}}},
      scales:{x:{ticks:{color:'#9ca3af'},grid:{color:'#222'}},y:{ticks:{color:'#9ca3af'},grid:{color:'#222'}}}}); };
  const bar = (sel,labels,dataArr,horizontal=false)=>{ const el=$(sel); if(!el) return;
    new Chart(el,{type:'bar',data:{labels,datasets:[{label:'Montants',data:dataArr}]},
      options:{indexAxis: horizontal?'y':'x',responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#e6e6e6'}}},
      scales:{x:{ticks:{color:'#9ca3af'},grid:{color:'#222'}},y:{ticks:{color:'#9ca3af'},grid:{color:'#222'}}}}); };

  // ===== Data
  let data={}; try{ data=JSON.parse(id('AUDIT_DATA').textContent); }catch(e){ alert('Config JSON invalide.'); return; }

  // ===== Bind header
  setText('#companyName', data.company?.name);
  setText('#period', data.company?.period);
  setText('#auditId', data.company?.auditId);
  setText('#auditDate', data.company?.date);
  setText('#kpiCash', eur(data.company?.cash));
  setText('#kpiImpact', `${data.executive?.impactScore||0}/100`);
  setText('#kpiDD', `${Number(data.executive?.drawdownMaxPct||0).toFixed(1)} %`);
  setText('#kpiExit', data.executive?.exitWindow);
  setText('#commitHash', data.security?.commitHash);
  setText('#reportUrl', data.reportUrl);
  setText('#year', data.security?.year);

  listTo('#executiveBullets', data.executive?.bullets);
  listTo('#liquidityBullets', data.liquidity?.bullets);
  listTo('#complianceList', data.compliance?.items);
  orderedListTo('#recoList', data.recommendations?.steps);
  listTo('#plan90', data.recommendations?.plan90);
  listTo('#methodo', data.methodology);
  listTo('#assumptionsList', data.assumptions);

  // ===== QR
  try { new QRCode(id('qrcode'), { text: data.reportUrl, width: 92, height: 92 }); } catch(e){}

  // ===== Overview chart
  const scen = data.scenarios||{};
  line('#chartOverview',{labels:labelsMonths(scen.horizonMonths||24),datasets:[
    ds('Baseline', scen.baseline),
    ds('Scénario 1 %', scen.series?.[0]?.monthly),
    ds('Scénario 3 %', scen.series?.[1]?.monthly),
    ds('Scénario 5 %', scen.series?.[2]?.monthly),
  ]});

  // ===== Scenario tables
  function buildScenario(key, serie, baseline, startCash){
    if(!serie) return;
    line('#chart'+key,{labels:labelsMonths((serie.monthly||[]).length),datasets:[ds('Baseline',baseline||[]),ds(`Scénario ${serie.name}`,serie.monthly||[])]});
    const t=id('table'+key); if(!t) return;
    const bl = baseline||[];
    const sum=a=>(a||[]).reduce((x,y)=>x+y,0);
    t.innerHTML = `
      <thead><tr><th>Mois</th><th>Baseline</th><th>Scénario ${serie.name}</th><th>Écart</th></tr></thead>
      <tbody>${
        (serie.monthly||[]).map((v,i)=>{const b=bl[i]??bl[bl.length-1]??0;const g=v-b;return `<tr><td>M${i+1}</td><td>${eur(b)}</td><td>${eur(v)}</td><td>${g>=0?'+':''}${eur(g)}</td></tr>`}).join('')
      }</tbody>
      <tfoot><tr><th>Total</th><th>${eur(sum(bl)-(startCash||0))}</th><th>${eur(sum(serie.monthly||[])-(startCash||0))}</th><th>${eur(sum(serie.monthly||[])-sum(bl))}</th></tr></tfoot>`;
  }
  buildScenario('S1', scen.series?.[0], scen.baseline, data.company?.cash||0);
  buildScenario('S3', scen.series?.[1], scen.baseline, data.company?.cash||0);
  buildScenario('S5', scen.series?.[2], scen.baseline, data.company?.cash||0);

  // ===== Sensitivity (barres horizontales en € d’écart vs baseline M24)
  (function buildSensitivity(){
    const bl = scen.baseline||[];
    const lastBl = bl[bl.length-1]||0;
    // simplifié: +/- variations appliquées sur la dernière valeur du scénario 3 %
    const s3 = scen.series?.[1]?.monthly||[];
    const lastS3 = s3[s3.length-1]||0;

    const variables = [
      { name:"Inflation −1 pt", factor: +0.005 },
      { name:"Inflation +1 pt", factor: -0.005 },
      { name:"Taux sans risque −1 pt", factor: -0.005 },
      { name:"Taux sans risque +1 pt", factor: +0.005 },
      { name:"Prime crypto −20 %", factor: -0.20 },
      { name:"Prime crypto +20 %", factor: +0.20 }
    ];
    const labels = variables.map(v=>v.name);
    const values = variables.map(v => Math.round((lastS3 - lastBl)*(1+v.factor)));
    bar('#chartSensitivity', labels, values, true);

    // ROI net estimé affiché en annexe
    const roi = lastS3 - lastBl;
    setText('#roiNet', (roi>=0?'+':'') + eur(roi));
  })();

  // ===== Liquidity
  const lb=(data.liquidity?.buckets||[]);
  bar('#chartLiquidity', lb.map(b=>b.label), lb.map(b=>b.amount));

  // ===== Export CSV (tables S1/S3/S5 concat)
  function toCSV(){
    const hdr = ['Scenario','Mois','Baseline','Scenario','Ecart'];
    const rows = [];
    [['S1',scen.series?.[0]],['S3',scen.series?.[1]],['S5',scen.series?.[2]]].forEach(([key,serie])=>{
      if(!serie) return;
      const bl = scen.baseline||[];
      (serie.monthly||[]).forEach((v,i)=>{
        const b = bl[i]??bl[bl.length-1]??0;
        rows.push([serie.name,`M${i+1}`,b,v,v-b]);
      });
    });
    const csv = [hdr.join(','), ...rows.map(r=>r.join(','))].join('\n');
    const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
    a.download = 'audit-scenarios.csv'; document.body.appendChild(a); a.click(); a.remove();
  }
  id('btnCSV')?.addEventListener('click', toCSV);

  // ===== PDF + Hash
  id('btnDownload')?.addEventListener('click', ()=>window.print());
  id('btnHash')?.addEventListener('click', async ()=>{
    const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
    const hash = await crypto.subtle.digest('SHA-256', await blob.arrayBuffer());
    const hex = [...new Uint8Array(hash)].map(b=>b.toString(16).padStart(2,'0')).join('');
    setText('#pdfHash', hex);
  });

})();
</script>
</body>
</html>
